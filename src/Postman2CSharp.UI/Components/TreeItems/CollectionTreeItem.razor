@inherits MainLayoutComponent

@if (ApiClientGroups != null)
{
    <MudTreeView T="string" Class="collection-tree-root" Hover ExpandOnClick>
     <CascadingValue Value="this">
         @foreach (var group in ApiClientGroups)
         {
             <div class="f-column">
                 @foreach (var apiClient in group)
                 {
                     <ApiClientTreeItem ApiClient="apiClient" ApiCollection="ApiCollection"/>
                 }
             </div>
         }
     </CascadingValue>
    </MudTreeView>
}

@code {

    [Parameter]
    public ApiCollection? ApiCollection { get; set; }

    private List<List<ApiClient>>? ApiClientGroups { get; set; }

    private ApiCollection? _cachedApiCollection;
    protected override void OnParametersSet()
    {
        if (ApiCollection == _cachedApiCollection)
        {
            _shouldRender = false;
            return;
        }
        ApiClientGroups = GroupEqually(ApiCollection?.ApiClients ?? new(), 3);
        _shouldRender = true;
        _cachedApiCollection = ApiCollection;
    }

    private bool _shouldRender = true;
    protected override bool ShouldRender()
    {
        return _shouldRender;
    }

    private static List<List<T>> GroupEqually<T>(List<T> list, int numberOfGroups)
    {
        int itemsPerGroup = (int)Math.Ceiling((double)list.Count / numberOfGroups);
        List<List<T>> groupedLists = new List<List<T>>();

        for (int i = 0; i < list.Count; i += itemsPerGroup)
        {
            List<T> group = list.Skip(i).Take(itemsPerGroup).ToList();
            groupedLists.Add(group);
        }

        return groupedLists;
    }

}

